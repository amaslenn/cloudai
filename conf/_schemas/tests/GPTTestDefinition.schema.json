{
  "$defs": {
    "GPTCmdArgs": {
      "additionalProperties": false,
      "description": "GPT JAX Toolbox test command arguments.",
      "properties": {
        "docker_image_url": {
          "title": "Docker Image Url",
          "type": "string"
        },
        "load_container": {
          "default": true,
          "title": "Load Container",
          "type": "boolean"
        },
        "output_path": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Output Path"
        },
        "fdl_config": {
          "title": "Fdl Config",
          "type": "string"
        },
        "fdl": {
          "$ref": "#/$defs/GPTFdl"
        },
        "xla_flags": {
          "$ref": "#/$defs/GPTXLAFlags"
        },
        "setup_flags": {
          "$ref": "#/$defs/GPTSetupFlags"
        }
      },
      "required": [
        "docker_image_url",
        "fdl_config"
      ],
      "title": "GPTCmdArgs",
      "type": "object"
    },
    "GPTFdl": {
      "additionalProperties": false,
      "description": "GPT FDL configuration.",
      "properties": {
        "checkpoint_policy": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "default": "save_nothing",
          "title": "Checkpoint Policy"
        },
        "dcn_mesh_shape": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "default": "'[1, 1, 1]'",
          "title": "Dcn Mesh Shape"
        },
        "fprop_dtype": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "default": "bfloat16",
          "title": "Fprop Dtype"
        },
        "ici_mesh_shape": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "default": "'[1, 8, 1]'",
          "title": "Ici Mesh Shape"
        },
        "max_steps": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            }
          ],
          "default": 20,
          "title": "Max Steps"
        },
        "num_gpus": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            }
          ],
          "default": 64,
          "title": "Num Gpus"
        },
        "num_microbatches": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            }
          ],
          "default": 1,
          "title": "Num Microbatches"
        },
        "num_stages": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            }
          ],
          "default": 1,
          "title": "Num Stages"
        },
        "percore_batch_size": {
          "anyOf": [
            {
              "type": "number"
            },
            {
              "items": {
                "type": "number"
              },
              "type": "array"
            }
          ],
          "default": 4,
          "title": "Percore Batch Size"
        },
        "use_fp8": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            }
          ],
          "default": 1,
          "title": "Use Fp8"
        },
        "use_repeated_layer": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "items": {
                "type": "boolean"
              },
              "type": "array"
            }
          ],
          "default": false,
          "title": "Use Repeated Layer"
        },
        "num_groups": {
          "default": 64,
          "title": "Num Groups",
          "type": "integer"
        }
      },
      "title": "GPTFdl",
      "type": "object"
    },
    "GPTSetupFlags": {
      "additionalProperties": false,
      "description": "GPT setup flags.",
      "properties": {
        "docker_workspace_dir": {
          "default": "/opt/paxml/workspace/",
          "title": "Docker Workspace Dir",
          "type": "string"
        },
        "enable_checkpoint_saving": {
          "default": false,
          "title": "Enable Checkpoint Saving",
          "type": "boolean"
        },
        "gpus_per_node": {
          "default": 8,
          "title": "Gpus Per Node",
          "type": "integer"
        },
        "mpi": {
          "default": "pmix",
          "title": "Mpi",
          "type": "string"
        },
        "num_nodes": {
          "default": 8,
          "title": "Num Nodes",
          "type": "integer"
        },
        "tfds_data_dir": {
          "default": "/opt/dataset",
          "title": "Tfds Data Dir",
          "type": "string"
        },
        "gpt_vocab_path": {
          "default": "gs://t5-data/vocabs/cc_all.32000.100extra/sentencepiece.model",
          "title": "Gpt Vocab Path",
          "type": "string"
        }
      },
      "title": "GPTSetupFlags",
      "type": "object"
    },
    "GPTXLAFlags": {
      "additionalProperties": false,
      "description": "GPT XLA flags.",
      "properties": {
        "xla_disable_hlo_passes": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "default": "rematerialization",
          "title": "Xla Disable Hlo Passes"
        },
        "xla_dump_hlo_pass_re": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "default": ".*",
          "title": "Xla Dump Hlo Pass Re"
        },
        "xla_gpu_enable_all_gather_combine_by_dim": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "items": {
                "type": "boolean"
              },
              "type": "array"
            }
          ],
          "default": false,
          "title": "Xla Gpu Enable All Gather Combine By Dim"
        },
        "xla_gpu_enable_highest_priority_async_stream": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "items": {
                "type": "boolean"
              },
              "type": "array"
            }
          ],
          "default": true,
          "title": "Xla Gpu Enable Highest Priority Async Stream"
        },
        "xla_gpu_enable_latency_hiding_scheduler": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "items": {
                "type": "boolean"
              },
              "type": "array"
            }
          ],
          "default": true,
          "title": "Xla Gpu Enable Latency Hiding Scheduler"
        },
        "xla_gpu_enable_pipelined_all_gather": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "items": {
                "type": "boolean"
              },
              "type": "array"
            }
          ],
          "default": true,
          "title": "Xla Gpu Enable Pipelined All Gather"
        },
        "xla_gpu_enable_pipelined_all_reduce": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "items": {
                "type": "boolean"
              },
              "type": "array"
            }
          ],
          "default": true,
          "title": "Xla Gpu Enable Pipelined All Reduce"
        },
        "xla_gpu_enable_pipelined_reduce_scatter": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "items": {
                "type": "boolean"
              },
              "type": "array"
            }
          ],
          "default": true,
          "title": "Xla Gpu Enable Pipelined Reduce Scatter"
        },
        "xla_gpu_enable_reduce_scatter_combine_by_dim": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "items": {
                "type": "boolean"
              },
              "type": "array"
            }
          ],
          "default": false,
          "title": "Xla Gpu Enable Reduce Scatter Combine By Dim"
        },
        "xla_gpu_enable_triton_gemm": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "items": {
                "type": "boolean"
              },
              "type": "array"
            }
          ],
          "default": false,
          "title": "Xla Gpu Enable Triton Gemm"
        },
        "xla_gpu_enable_triton_softmax_fusion": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "items": {
                "type": "boolean"
              },
              "type": "array"
            }
          ],
          "default": false,
          "title": "Xla Gpu Enable Triton Softmax Fusion"
        },
        "xla_gpu_enable_while_loop_double_buffering": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "items": {
                "type": "boolean"
              },
              "type": "array"
            }
          ],
          "default": false,
          "title": "Xla Gpu Enable While Loop Double Buffering"
        },
        "xla_gpu_graph_level": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            }
          ],
          "default": 0,
          "title": "Xla Gpu Graph Level"
        },
        "xla_gpu_all_reduce_combine_threshold_bytes": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            }
          ],
          "default": 447741952,
          "title": "Xla Gpu All Reduce Combine Threshold Bytes"
        }
      },
      "title": "GPTXLAFlags",
      "type": "object"
    }
  },
  "additionalProperties": false,
  "description": "Test object for GPT.",
  "properties": {
    "name": {
      "title": "Name",
      "type": "string"
    },
    "description": {
      "title": "Description",
      "type": "string"
    },
    "test_template_name": {
      "title": "Test Template Name",
      "type": "string"
    },
    "cmd_args": {
      "$ref": "#/$defs/GPTCmdArgs"
    },
    "extra_env_vars": {
      "additionalProperties": {
        "type": "string"
      },
      "default": {},
      "title": "Extra Env Vars",
      "type": "object"
    },
    "extra_cmd_args": {
      "additionalProperties": {
        "type": "string"
      },
      "default": {},
      "title": "Extra Cmd Args",
      "type": "object"
    }
  },
  "required": [
    "name",
    "description",
    "test_template_name",
    "cmd_args"
  ],
  "title": "GPTTestDefinition",
  "type": "object"
}